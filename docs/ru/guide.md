# Email в каналах и группах Telegram

![EmailGateBot logo](../logo.png)

@EmailGateBot публикует содержание отправленного ему email в каналах и группах Telegram.

Можно публиковать файлы любого поддерживаемого Telegram типа (картинки, голос, стикеры и т.п.). Сообщения могут содержать кнопки перехода по ссылке и кнопки опроса (до 20 опций) с иконками эмодзи. Список участвовавших в опросе пользователей можно просматривать. Есть возможность публиковать сообщения в заданное время (до 30 дней вперед) и автоматически менять по вашим правилам публикуемый текст. Опубликованные сообщения могут содержать разметку Markdown или HTML. Сообщения можно "прикреплять" и позже редактировать в Telegram.

По сравнению с GmailBot и подобными боты, EmailGateBot не может отправлять исходящие email из Telegram и не требует доступа к вашим почтовым аккаунтам.

## Как постить

Вы постите сообщения в чаты Telegram, отправляя емейл на адрес `специальный_код@telegram-email.appspotmail.com`

Чтобы бот мог постить сообщения в группу, добавьте его как участника. Бот сообщит вам в привате код, который нужно указать в адресе письма, чтобы сообщения попадали в данную группу.

Чтобы постить сообщения в канал, отправьте в приватный чат с ботом команду `/start` и следуйте инструкциям от бота.

Когда вы в первый раз отправляете в чат сообщение с нового email, бот попросит у вас подтверждения на прием писем с этого адреса. Чтобы запретить боту писать в чат, удалите его из соответствующего канала/группы.

## "черный" и "белый" списки почтовых адресов

Когда на емейл-адрес чата впервые поступает сообщение с нового емейл-адреса, бот спрашивает у вас, что делать с письмами с этого адреса.

Если вы нажимаете кнопку меню "Разрешить навсегда" или "Запретить навсегда", то данный емейл-адрес попадает соответственно в "белый" или "черный" список адресов.

Последующие письма с адресов из "белого" списка публикуются автоматически, а письма с адресов из "черного" списка игнорируются. Если вы в дальнейшем изменили свое первоначальное решение и хотите запретить какому-либо адресу из "белого" списка автоматически публиковать сообщения, вам нужно сделать следующее.

Отправить команду `/start` в приват с ботом, выбрать группу, где нужно удалить емейл-адрес, выбрать из меню "Управление белым списком" (в самом конце меню, прокрутить колесиком мыши), выбрать нужный емейл-адрес из списка адресов, из меню выбрать "Удалить".

Управление "черным" списком аналогично управлению "белым" списком.

Вы можете полностью отключить проверку адресов входящих email и автоматически публиковать всю поступающую на адрес канала/группы почту, отображая в публикуемых сообщениях адрес, с которого оно поступило.
Используйте такой режим осторожно. Это потенциальная возможность для злоумышленника заспамить ваши каналы и группы.

## Публикация картинок и файлов

Вы можете публиковать изображения, вложив файл картинки в отправляемый email. Первые 1024 байта текста письма будут использованы как подпись к картинке. За сутки таким способом можно опубликовать не более 120 картинок. Лимит сбрасывается каждые сутки в 00:00 по Гринвичу. Массовая рассылка (см.далее) в несколько чатов через адрес post@telegram-email.appspotmail.com считается как одна картинка.

Кроме того, можно публиковать картинки и файлы любого типа другим способом. Отправьте в приватный чат боту файл, который нужно опубликовать. Бот ответит вам сообщением, которое содержит специальный код. Этот код нужно добавить как отдельную строку в тексте отправляемого email и этот файл будет опубликован.

Можно отправлять файлы следующих типов: аудио, анимация, фото, стикер, видео, голос, видео-сообщение и произвольный файл (документ). Файлы и изображения, отправленные таким способом, не учитываются в суточной квоте отправленных картинок. Если вы отправите email, содержащий одновременно и код и вложенный файл изображения, то будет опубликован вложенный файл картинки, а код будет проигнорирован.

## Отложенные, повторяющиеся и автоудаляемые публикации

Бот может отправлять отложенные сообщения. Чтобы это сделать, поместите специальный код в отдельную строку вашего письма. Например:

```
###start 31-12-2018 23:59
```

В этом случае сообщение будет опубликовано в чате Telegram в указанное время.

Чтобы опубликовать сообщение несколько раз в разное время, добавьте дополнительные строки с нужным временем публикации.

```
###start 31-12-2018 23:00
###start 31-12-2018 23:59
###start 01-01-2019 10:00
```

Чтобы опубликовать сообщение на заданное время, а затем автоматически его удалить, добавьте тег `stop` после тега `start`. Например, следующие строки в теле письма запланируют первую публикацию с ее удалением через 1 час, вторую публикацию через 1 час после удаления первой.

```
###start 01-01-2019 10:00 stop 01-01-2019 11:00
###start 01-01-2019 12:00
```

Время указывается по Гринвичу, не забудьте отнять смещение вашего часового пояса. Строки с кодом не будут включены в публикуемое сообщение. Вы можете планировать публикации на 30 дней вперед. Очередь каждого канала/группы может содержать до 10 запланированных задач.

Для каждого канала/группы можно просматривать очередь запланированных задач и управлять этими задачами.

## Прикрепленные сообщения

Бот может "прикреплять" отправляемые в супергруппы и каналы сообщения, если он имеет там соответствующие полномочия.

Чтобы "прикрепить" сообщение, добавьте в тело письма отдельную строку

```
###pin
```

Эта строка будет убрана из опубликованного сообщения, а само сообщение будет "прикреплено" в целевом канале/супергруппе.

## Опросы и голосования

Сообщения в Telegram, которые были отправлены через EmailGateBot, могут содержать любую комбинацию встроенных кнопок с иконками эмодзи. Если вы поместите в текст письма специальную строку `###buttons`, то остаток письма после этой строки будет интерпретирован как определение встроенных кнопок.

Текст внутри квадратных скобок создает встроенную кнопку голосования в опросе. Вы можете задать несколько таких определений в одной строке.

```
###buttons
[Да] [Нет]
```

Текст в заголовке кнопки может содержать коды, отображаемые как значки эмодзи. Полный список кодов эмодзи можно [посмотреть тут](http://www.unicode.org/emoji/charts/full-emoji-list.html) или воспользоваться командой `/emojicode` бота для получения кода нужного значка.

Если после закрывающей квадратной скобки сразу (без пробелов) следует открывающая круглая скобка, то такое определение кнопки интерпретируется как кнопка с url-ссылкой. Адрес url должен находиться внутри круглых скобок.

![сообщение от EmailGateBot](img/poll.PNG)

И все это можно смешивать в произвольных комбинациях. Например, чтобы создать опрос, показанный на картинке выше, тело письма должно быть таким:

```
To be or not to be?
###buttons ru
[{0001F44D} Yes] [{0001F44E}{0001F3FF} No]
[Может быть]
[{0001F1EC}{0001F1E7} Google](https://google.com)
[{0001F1F7}{0001F1FA} Яндекс](https://ya.ru)
```

И соответствующая картинка должна быть прикреплена к письму.

По умолчанию опрос будет активен 30 дней с момента создания. Это максимальное значение длительности опроса. Вы можете его уменьшить, задав продолжительность опроса в минутах в строке с `###buttons`. Например, для 10-минутного опроса:

```
###buttons 10
```

Для неактивных опросов кнопки и результаты голосования отображаются по прежнему, но нажатия на кнопки не засчитывается в результаты голосования.

## Просмотр результатов опроса

Во все опросы, создаваемые при помощи бота, автоматически добавляется кнопка "Кто голосовал?".

После перехода по этой кнопке можно увидеть список 10 последних голосов в опросе. Каждый голос представляет собой ссылку на профиль Telegram проголосовавшего. Если в опросе проголосовало более 10 человек, то в список автоматически добавляются кнопки для перехода на следующую/предыдущую страницы списка голосовавших.

Также при просмотре списка голосовавших в опросе можно переслать в приват с ботом контакт из вашего списка или сообщение от любого пользователя Telegram. Бот скажет, как этот пользователь или контакт голосовал в просматриваемом опросе.

## Эмодзи, форматирование и разметка текста

В текст сообщений можно включать эмоджи-смайлики.
В тексте письма в фигурных скобках укажите код нужного эмоджи и этот смайлик появится в опубликованном в Telegram сообщении. Например:

```
{0001F44D}
```

Чтобы узнать код смайлика, отправьте в приват боту команду `/emojicode` а затем нужный вам смайлик.

Текст в сообщении email может содержать разметку двух поддерживаемых Telegram типов: [Markdown](https://core.telegram.org/bots/api#markdown-style) или [HTML](https://core.telegram.org/bots/api#html-style). Для включения разметки добавьте код

```
###text_mode markdown
```

или

```
###text_mode html
```

в отдельной строке вашего письма. Строка с данным кодом не будет включена в опубликованное сообщение.

Если вы используете разметку HTML, то ваша почтовая программа должна отправлять email с заголовком

```
Content-Type: text/plain
```

В противном случае html-теги в сообщении не будут работать.

## Автоматическое преобразование текста

Довольно часто автоматически генерируемые сообщения email, которые пересылаются в Telegram через EmailGateBot, содержат избыточную и служебную информацию, которая не требуется пользователю, а только захламляет чат. Такие сообщения требуется обработать таким способом, чтобы оставить только важную и нужную информацию.

Другим распространенным случаем является публикация сообщений из источников, которые вы не контролируете. В этой ситуации часто требуется автоматическая модерация поступающего контента.

Для таких случаев, а также похожих на них, EmailGateBot предоставляет функцию автоматического преобразования текста.

Эта функция доступна через пункт "Задать преобразование текста" в меню управления адресом email из белого списка (меню управления чатом, "управление белым списком", выбрать емейл). Там вы можете задать адрес сервера в интернет, куда бот будет отправлять текст получаемых с этого email писем. В чате Telegram бот будет публиковать текст из ответа этого сервера.

Вы можете создать и развернуть собственный сервер или использовать встроенный в EmailGateBot [обработчик оповещений с открытым исходным кодом](transform_text.md).

## Редактирование опубликованных сообщений

Вы можете редактировать сообщения Telegram, отправленные через EmailGateBot. Ответьте на опубликованное ботом сообщение с цитированием и текст из вашего ответа заменит текст исходного сообщения.

Для использования форматирования включите в текст ответа специальный код `###text_mode markdown` или `###text_mode html` на отдельной строке. Эта строка не будет включена в новый тест сообщения.

Бот автоматически удалит ваш ответ с новым текстом сообщения, если у него есть полномочия на удаление чужих сообщений в соответствующем чате. Если такого полномочия у него нет, вам будет нужно удалить свой ответ самостоятельно (если это необходимо).

Есть несколько ограничений.

- редактирование не работает для сообщений, опубликованных ранее 13 февраля 2018 18:00 по Гринвичу
- редактирование не работает в приватном чате с ботом
- в группах и супергруппах редактировать сообщения бота может пользователь, который добавил бота в эту группу
- редактирование работает в каналах, где включен режим "подписывать сообщения"

## Массовые рассылки

Допустим, вы добавили EmailGateBot в 1000 чатов и хотите опубликовать свое текстовое объявление во всех этих чатах. Вы отправляете сообщение на адрес одного чата, а остальные 999 адресов добавляете в поле "Копия". EmailGateBot разошлет ваше сообщение в 1000 чатов в течение нескольких минут.

Дело обстоит по другому, если рассылаемое сообщение содержит картинку. При отправке сообщения с картинкой обычным способом, эту картинку нужно будет 1000 раз загрузить в Telegram. При этом обязательно возникнут ошибки. Поэтому EmailGateBot не гарантирует доставку сообщений с картинками при рассылке обычным способом.

Для массовой рассылки сообщений с картинками EmailGateBot предлагает альтернативный способ рассылки. Вам нужно отправить сообщение с картинкой на адрес post@telegram-email.appspotmail.com

В поле Тема (Subject) этого письма нужно поместить список кодов чатов, куда нужно разослать данное сообщение. Код чата - это часть до символа '@' в email-адресе, используемом для постинга в чат. Например, если для постинга в чат вы используете полученный у EmailGateBot адрес '123456789@telegram-email.appspotmail.com', то кодом чата будет '123456789'. Коды чатов в поле темы письма должны разделяться пробелами.

При таком способе отправки ваша картинка будет загружена в Telegram один раз и EmailGateBot сможет разослать сообщение с картинкой по указанному списку чатов без ошибок.

## Список команд бота

`/start` - Самая главная команда. Если вы запутались в меню бота, то при помощи этой команды вы вернетесь к стартовому сообщению бота со списком ваших чатов.

`/language` - Задает язык, на котором бот общается с вами в приватном чате.

`/help` - Краткая информация по использованию бота.

`/chatlist` - Создает csv файл со списком ваших чатов. Полезно, когда чатов много и хочется посмотреть их список в виде таблички. Файл создается в кодировке UTF-8, его можно открывать в MS Excel. Для каждого чата отображаются:

- тип (канал, группа)
- название
- адрес email для постинга

`/emojicode` - Для значка эмодзи показывает код для использования в кнопках опроса.

`/clearkeyboard` - Если какой-то неаккуратный или зловредный бот активировал и оставил в вашей группе пользовательскую клавиатуру, то ее можно удалить при помощи этой команды.

`/donate` - Для желающих поддержать деньгами развитие проекта.

## Поддержка пользователей

Дополнительную информацию по использованию бота и контакты разработчика можно получить через команду `/help`.

Для начала работы в поиске Telegram введите @EmailGateBot, выберите его и нажмите кнопку СТАРТ.
